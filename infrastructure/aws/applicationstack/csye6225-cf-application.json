{

	"AWSTemplateFormatVersion":"2010-09-09",
	"Description":"Assignment4 csye6225 web application hosted on EC2 ",


	"Resources": {

		"EC2Instance": {
			"Type": "AWS::EC2::Instance",
			"Properties": {
				"ImageId": "ami-9887c6c7",
				"InstanceType": "t2.micro",
				"BlockDeviceMappings": [
					{
						"Ebs": {
							"VolumeType": "GP2",
							"VolumeSize": "20",
							"DeleteOnTermination": "true"
						}
					}
				]
			},
			"SecurityGroupIds": [
				{
					"Fn::GetAtt": [
						"WebServerSecurityGroup",
						"GroupId"
					]
				}
			]
		},


		"InstanceSecurityGroup": {
			"Type": "AWS::EC2::SecurityGroup",
			"Properties": {
				"GroupDescription": "Allow TCP traffic on port 22,80,443 from anywhere",
				"VpcId":{ "Ref":"ParamVpcId"},
				"SecurityGroupIngress": [
					{
						"IpProtocol": "tcp",
						"FromPort": "22",
						"ToPort": "22",
						"CidrIp": "0.0.0.0/0"
					},
					{
						"IpProtocol": "tcp",
						"FromPort": "80",
						"ToPort": "80",
						"CidrIp": "0.0.0.0/0"
					},
					{
						"IpProtocol": "tcp",
						"FromPort": "443",
						"ToPort": "443",
						"CidrIp": "0.0.0.0/0"
					}
				]
			}
		},


		"DynamoDB": {
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": "csye6225",
				"KeySchema": [
					{
						"AttributeName": "id",
						"KeyType": "string"
					}
				]
			}
		},

		"DBInstance": {
			"Type": "AWS::RDS::DBInstance",
			"Properties": {
				"Engine": "Mysql",
				"DBInstanceClass": "db.t2.medium",
				"MultiAZ": "false",
				"DBInstanceIdentifier": "csye6225-spring2019",
				"MasterUsername": "csye6225master",
				"MasterPassword": "csye6225password",
				"PubliclyAccessible": "true",
				"DBName": "csye6225",
				"DBSecurityGroups": [
					{
						"Ref": "RDSSecurityGroup"
					}
				]
			}
		},


		"RDSSecurityGroup": {
			"Type": "AWS::RDS::DBSecurityGroup",
			"Properties": {
				"GroupDescription": "RDS instance security group",
				"SecurityGroupIngress": [
					{
						"IpProtocol": "tcp",
						"FromPort": "3306",
						"ToPort": "3306",
						"CidrIp": ""
					}]
			}
		},


		"S3Bucket": {
			"Type": "AWS::S3::Bucket",
			"Properties": {
				"BucketName":"csye6225-spring2019-huangxinx.me.csye6225.com"
			}
		}

	}

}


